devtools::load_all(".")
Pagwas<-Singlecell_heritability_contributions(Pagwas,
n.cores=1,
part = 0.5,
bignumber=10000,
iters = 200)
#1.start to run the wrapper functions for preprogress.
Pagwas<-scPagwas_main(Pagwas = NULL,
gwas_data =system.file("extdata", "GWAS_summ_example.txt", package = "scPagwas"),
add_eqtls="OnlyTSS",
block_annotation = block_annotation,
assay="RNA",
Single_data = system.file("extdata", "scRNAexample.rds", package = "scPagwas"),
nfeatures =NULL,
Pathway_list=Genes_by_pathway_kegg,
chrom_ld = chrom_ld)
##------ Sun Mar 27 15:54:11 2022 ------##
##------ Sun Mar 27 15:54:17 2022 ------##
##------ Sun Mar 27 15:54:22 2022 ------##
##------ Sun Mar 27 15:54:22 2022 ------##
##------ Sun Mar 27 15:54:22 2022 ------##
##------ Sun Mar 27 15:54:23 2022 ------##
Pagwas<-Singlecell_heritability_contributions(Pagwas,
n.cores=1,
part = 0.5,
bignumber=10000,
iters = 200)
require("RColorBrewer")
require("Seurat")
require("SeuratObject")
require("ggsci")
#check the objects
Single_data<-FindVariableFeatures(Single_data)
scRNAexample<-readRDS(system.file("extdata", "scRNAexample.rds", package = "scPagwas"))
scPagwas_Visualization(scPagwas_score = Pagwas$scPagwas_score,
Single_data = scRNAexample,
Reduction = TRUE,
assay = "SCT",
cellpercent = 0.5,
filename = NULL,
FigureType = "tsne",
width = 7,
height = 7,
lowColor = "#FFBC80", highColor = "#FC4F4F",
size = 1,
title = "scPagwas_score",
do_plot = T)
require("RColorBrewer")
require("Seurat")
require("SeuratObject")
require("ggsci")
#check the objects
Single_data<-FindVariableFeatures(Single_data)
scRNAexample<-readRDS(system.file("extdata", "scRNAexample.rds", package = "scPagwas"))
scPagwas_Visualization(scPagwas_score = Pagwas$scPagwas_score,
Single_data = scRNAexample,
Reduction = TRUE,
assay = "SCT",
cellpercent = 0.1,
filename = NULL,
FigureType = "tsne",
width = 7,
height = 7,
lowColor = "#FFBC80", highColor = "#FC4F4F",
size = 1,
title = "scPagwas_score",
do_plot = T)
require("RColorBrewer")
require("Seurat")
require("SeuratObject")
require("ggsci")
#check the objects
Single_data<-FindVariableFeatures(Single_data)
scRNAexample<-readRDS(system.file("extdata", "scRNAexample.rds", package = "scPagwas"))
scPagwas_Visualization(scPagwas_score = Pagwas$scPagwas_score,
Single_data = scRNAexample,
Reduction = TRUE,
assay = "SCT",
cellpercent = 0.15,
filename = NULL,
FigureType = "tsne",
width = 7,
height = 7,
lowColor = "#FFBC80", highColor = "#FC4F4F",
size = 1,
title = "scPagwas_score",
do_plot = T)
require("RColorBrewer")
require("Seurat")
require("SeuratObject")
require("ggsci")
#check the objects
Single_data<-FindVariableFeatures(Single_data)
scRNAexample<-readRDS(system.file("extdata", "scRNAexample.rds", package = "scPagwas"))
scPagwas_Visualization(scPagwas_score = Pagwas$scPagwas_score,
Single_data = scRNAexample,
Reduction = TRUE,
assay = "SCT",
cellpercent = 0.2,
filename = NULL,
FigureType = "tsne",
width = 7,
height = 7,
lowColor = "#FFBC80", highColor = "#FC4F4F",
size = 1,
title = "scPagwas_score",
do_plot = T)
Pagwas$scPagwas_score
require("RColorBrewer")
require("Seurat")
require("SeuratObject")
require("ggsci")
#check the objects
#Single_data<-FindVariableFeatures(Single_data)
scRNAexample<-readRDS(system.file("extdata", "scRNAexample.rds", package = "scPagwas"))
scPagwas_Visualization(scPagwas_score = Pagwas$scPagwas_score,
Single_data = scRNAexample,
Reduction = TRUE,
assay = "SCT",
cellpercent = 0.1,
filename = NULL,
FigureType = "tsne",
width = 7,
height = 7,
lowColor = "#FFBC80", highColor = "#FC4F4F",
size = 1,
title = "scPagwas_score",
do_plot = T)
library("RColorBrewer")
library("ggplot2")
scPagwas_score <- Pagwas$scPagwas_score[intersect(colnames(scRNAexample),names(Pagwas$scPagwas_score))]
scRNAexample$scPagwas_score <- scPagwas_score
thre <- sort(scRNAexample$scPagwas_score, decreasing = T)[ncol(scRNAexample) * 0.1]
scRNAexample$positiveCells<-rep(0,ncol(scRNAexample))
scRNAexample$positiveCells[scRNAexample$scPagwas_score>=thre]<-1
plot_bar_positie_nagtive(seurat_obj=scRNAexample,
var_ident="positiveCells",
var_group="anno",
vec_group_colors=NULL,
f_color=colorRampPalette(brewer.pal(n=10, name="RdYlBu")),
do_plot = T)
plot_bar_positie_nagtive(seurat_obj=scRNAexample,
var_ident="anno",
var_group="positiveCells",
vec_group_colors=c("#E8D0B3","#7EB5A6"),
do_plot = T)
top5genes<-rownames(Pagwas$gene_heritability_correlation)[order(Pagwas$gene_heritability_correlation,decreasing = T)[1:5]]
plot_vln_Corgenes(seurat_obj=scRNAexample,
assay="RNA", slot="data",
var_group="anno",
vec_features=top5genes,
vec_group_colors= pal_d3(alpha =0.5)(10),
do_plot = T
)
top5genes<-rownames(Pagwas$gene_heritability_correlation)[order(Pagwas$gene_heritability_correlation,decreasing = T)[1:5]]
top5genes
Pagwas$gene_heritability_correlation
devtools::document()
library(scPagwas)
suppressMessages(library(Seurat))
suppressWarnings(library(SOAR))
suppressMessages(library("dplyr"))
#Input pathway gene list, you can construct with youself.
data(Genes_by_pathway_kegg)
#gene annotation files.
data(block_annotation)
#LD data
data(chrom_ld)
#1.start to run the wrapper functions for preprogress.
Pagwas<-scPagwas_main(Pagwas = NULL,
gwas_data =system.file("extdata", "GWAS_summ_example.txt", package = "scPagwas"),
add_eqtls="OnlyTSS",
block_annotation = block_annotation,
assay="RNA",
Single_data = system.file("extdata", "scRNAexample.rds", package = "scPagwas"),
nfeatures =NULL,
Pathway_list=Genes_by_pathway_kegg,
chrom_ld = chrom_ld)
##------ Sun Mar 27 16:41:25 2022 ------##
##------ Sun Mar 27 16:41:28 2022 ------##
##------ Sun Mar 27 16:41:32 2022 ------##
##------ Sun Mar 27 16:41:32 2022 ------##
##------ Sun Mar 27 16:41:33 2022 ------##
##------ Sun Mar 27 16:41:34 2022 ------##
Pagwas<-Celltype_heritability_contributions(Pagwas,iters = 200)
names(Pagwas)
Bootstrap_P_Barplot(Pagwas=Pagwas,
figurenames = NULL,
width = 5,
height = 7,
do_plot=T,
title = "Test scPagwas")
Pagwas<-Singlecell_heritability_contributions(Pagwas,
n.cores=1,
part = 0.5,
bignumber=10000,
iters = 200)
Pagwas$gene_heritability_correlation
top5genes<-rownames(Pagwas$gene_heritability_correlation)[order(Pagwas$gene_heritability_correlation,decreasing = T)[1:5]]
top5genes
top5genes<-rownames(Pagwas$gene_heritability_correlation)[order(Pagwas$gene_heritability_correlation,decreasing = T)[1:5]]
plot_vln_Corgenes(seurat_obj=scRNAexample,
assay="RNA", slot="data",
var_group="anno",
vec_features=top5genes,
vec_group_colors= pal_d3(alpha =0.5)(10),
do_plot = T
)
scRNAexample<-readRDS(system.file("extdata", "scRNAexample.rds", package = "scPagwas"))
plot_bar_positie_nagtive(seurat_obj=scRNAexample,
var_ident="anno",
var_group="positiveCells",
vec_group_colors=c("#E8D0B3","#7EB5A6"),
do_plot = T)
library("RColorBrewer")
library("ggplot2")
scPagwas_score <- Pagwas$scPagwas_score[intersect(colnames(scRNAexample),names(Pagwas$scPagwas_score))]
scRNAexample$scPagwas_score <- scPagwas_score
thre <- sort(scRNAexample$scPagwas_score, decreasing = T)[ncol(scRNAexample) * 0.1]
scRNAexample$positiveCells<-rep(0,ncol(scRNAexample))
scRNAexample$positiveCells[scRNAexample$scPagwas_score>=thre]<-1
plot_bar_positie_nagtive(seurat_obj=scRNAexample,
var_ident="positiveCells",
var_group="anno",
vec_group_colors=NULL,
f_color=colorRampPalette(brewer.pal(n=10, name="RdYlBu")),
do_plot = T)
plot_bar_positie_nagtive(seurat_obj=scRNAexample,
var_ident="anno",
var_group="positiveCells",
vec_group_colors=c("#E8D0B3","#7EB5A6"),
do_plot = T)
top5genes<-rownames(Pagwas$gene_heritability_correlation)[order(Pagwas$gene_heritability_correlation,decreasing = T)[1:5]]
plot_vln_Corgenes(seurat_obj=scRNAexample,
assay="RNA", slot="data",
var_group="anno",
vec_features=top5genes,
vec_group_colors= pal_d3(alpha =0.5)(10),
do_plot = T
)
names(Pagwas)
Pagwas[c("raw_data_mat","VariableFeatures","merge_scexpr","data_mat","rawPathway_list","Pathway_list","pca_scCell_mat","pca_cell_df","snp_gene_df","Pathway_ld_gwas_data")]<-NULL
names(Pagwas)
usethis::use_version()
pkgdown::build_site()
a<-big.matrix(10000,10000)
a<-bigmemory::big.matrix(10000,10000)
a<-big.matrix(10000,100)
a<-bigmemory::big.matrix(10000,100)
b<-matrix(rnorm(100*10000),nrow = 10000)
a[]<-b
a[1:10,1:10]
rownames(a)<-b
rownames(a)<-rownames(b)
b<-as(b,"dgcMatrix")
?as
b<-as(b,"dgCMatrix")
b
a[]<-b
a<-bigmemory::big.matrix(10000,100)
a[]<-b
?big.matrix
library(scPagwas)
suppressMessages(library(Seurat))
suppressWarnings(library(SOAR))
suppressMessages(library("dplyr"))
#Input pathway gene list, you can construct with youself.
data(Genes_by_pathway_kegg)
#gene annotation files.
data(block_annotation)
#LD data
data(chrom_ld)
Single_data = system.file("extdata", "scRNAexample.rds", package = "scPagwas")
Single_data=readRDS(Single_data)
nrow(Single_data)
ncol(Single_data)
devtools::load_all(".")
Pagwas<-scPagwas_main(Pagwas = NULL,
gwas_data =system.file("extdata", "GWAS_summ_example.txt", package = "scPagwas"),
add_eqtls="OnlyTSS",
block_annotation = block_annotation,
assay="RNA",
Single_data = system.file("extdata", "scRNAexample.rds", package = "scPagwas"),
nfeatures =NULL,
Pathway_list=Genes_by_pathway_kegg,
chrom_ld = chrom_ld)
##------ Mon Mar 28 09:21:57 2022 ------##
devtools::load_all(".")
Pagwas<-scPagwas_main(Pagwas = NULL,
gwas_data =system.file("extdata", "GWAS_summ_example.txt", package = "scPagwas"),
add_eqtls="OnlyTSS",
block_annotation = block_annotation,
assay="RNA",
Single_data = system.file("extdata", "scRNAexample.rds", package = "scPagwas"),
nfeatures =NULL,
Pathway_list=Genes_by_pathway_kegg,
chrom_ld = chrom_ld)
##------ Mon Mar 28 09:23:39 2022 ------##
##------ Mon Mar 28 09:23:40 2022 ------##
##------ Mon Mar 28 09:23:55 2022 ------##
##------ Mon Mar 28 09:23:55 2022 ------##
##------ Mon Mar 28 09:23:56 2022 ------##
##------ Mon Mar 28 09:23:57 2022 ------##
Pagwas<-Celltype_heritability_contributions(Pagwas,iters = 200)
names(Pagwas)
Bootstrap_P_Barplot(Pagwas=Pagwas,
figurenames = NULL,
width = 5,
height = 7,
do_plot=T,
title = "Test scPagwas")
Pagwas<-Singlecell_heritability_contributions(Pagwas,
n.cores=1,
part = 0.5)
devtools::load_all(".")
is.matrix(Pagwas_x)
devtools::load_all(".")
Pagwas<-Singlecell_heritability_contributions(Pagwas,
n.cores=1,
part = 0.5)
devtools::load_all(".")
Pagwas<-Singlecell_heritability_contributions(Pagwas,
n.cores=1,
part = 0.5)
paths<-names(Pagwas$Pathway_ld_gwas_data)
pa_block<-Pagwas$Pathway_ld_gwas_data[1]
pa_block<-Pagwas$Pathway_ld_gwas_data[[1]]
pathway <- unique(pa_block$block_info$pathway)
#message(pathway)
x <- matrix(Pagwas$pca_scCell_mat[pathway, ],nrow = 1)
rownames(x)<-pathway
#message(1)
#}
if (pa_block$n_snps == 0) {
pa_block$include_in_inference <- F
pa_block$x <- NULL # to make sure we totally replace previous stuffs
return(pa_block)
}
mg <- intersect(Pagwas$rawPathway_list[[pathway]],rownames(Pagwas$data_mat))
if (length(mg) == 1) {
x2<-matrix(Pagwas$data_mat[mg, ],nrow=1)
x2<- x2/(x2+0.0001)
rownames(x2)<-mg
}else{
x2 <-  biganalytics::apply(Pagwas$data_mat[mg, ],2,function(ge){
if (sum(ge) == 0) {
return(rep(0,length(ge)))
}else{
return(ge / sum(ge))
}
})
rownames(x2)<-mg
}
#message(2)
#if(ncol(x2)>10000){
x2 <- as(x2,"dgCMatrix")
#message(3)
#}
if (pa_block$n_snps > 1) {
x2 <-x2[pa_block$snps$label, ]
pa_block$n_snps <- nrow(pa_block$snps)
x <- x[rep(1, pa_block$n_snps), ]
rownames(x) <- pa_block$snps$rsid
rownames(Pagwas$snp_gene_df) <- Pagwas$snp_gene_df$rsid
#message(4)
x <- x * Pagwas$snp_gene_df[pa_block$snps$rsid, "slope"]
#if(ncol(x2)>10000){
#x <- as(x,"dgCMatrix")
#}
x2 <- x2 * x
#message(5)
#x3 <- bigstatsr::as_FBM(x3)
} else {
x2 <- matrix(x2[pa_block$snps$label, ], nrow = 1)
rownames(x2) <- pa_block$snps$label
pa_block$n_snps <- nrow(pa_block$snps)
x <- matrix(x[rep(1, pa_block$n_snps), ], nrow = 1)
rownames(x) <- pa_block$snps$rsid
rownames(Pagwas$snp_gene_df) <- Pagwas$snp_gene_df$rsid
x <- matrix(as.numeric(x) * as.numeric(Pagwas$snp_gene_df[pa_block$snps$rsid, "slope"]), nrow = 1)
x2 <- matrix(as.numeric(x2) * as.numeric(x), nrow = 1)
#if(ncol(x2)>10000){
x2 <- as(x2,"dgCMatrix")
#}
}
pa_block$x<- pa_block$ld_matrix_squared %*% x2
pa_block$include_in_inference <- T
#Pathway_block <- Pathway_ld_gwas_data[[Pathway]]
noise_per_snp <- pa_block$snps$se**2
class( pa_block$x)
is(Pagwas_x, 'dgeMatrix')
is(pa_block$x, 'dgeMatrix')
devtools::load_all(".")
Pagwas<-Singlecell_heritability_contributions(Pagwas,
n.cores=1,
part = 0.5)
x2
pa_block$x
class(pa_block$x)
pa_block$x<- as(pa_block$ld_matrix_squared %*% x2,"dgCMatrix")
na_elements <- is.na(pa_block$y) | apply(pa_block$x, 1, function(x) {
any(is.na(x))
}) | is.na(noise_per_snp)
results <- scParameter_regression(Pagwas_x = pa_block$x[!na_elements,],
Pagwas_y = pa_block$y[!na_elements],
noise_per_snp = noise_per_snp[!na_elements],
n.cores = n.cores
)
devtools::load_all(".")
Pagwas<-Singlecell_heritability_contributions(Pagwas,
n.cores=1,
part = 0.5)
devtools::load_all(".")
Pagwas<-Singlecell_heritability_contributions(Pagwas,
n.cores=1,
part = 0.5)
devtools::load_all(".")
Pagwas<-Singlecell_heritability_contributions(Pagwas,
n.cores=1,
part = 0.5)
devtools::load_all(".")
Pagwas<-Singlecell_heritability_contributions(Pagwas,
n.cores=1,
part = 0.5)
names(Pagwas)
devtools::load_all(".")
Pagwas<-Singlecell_heritability_contributions(Pagwas,
n.cores=1,
part = 0.5)
Pagwas
names(Pagwas)
require("RColorBrewer")
require("Seurat")
require("SeuratObject")
require("ggsci")
#check the objects
#Single_data<-FindVariableFeatures(Single_data)
scRNAexample<-readRDS(system.file("extdata", "scRNAexample.rds", package = "scPagwas"))
scPagwas_Visualization(scPagwas_score = Pagwas$scPagwas_score,
Single_data = scRNAexample,
Reduction = TRUE,
assay = "SCT",
cellpercent = 0.1,
filename = NULL,
FigureType = "tsne",
width = 7,
height = 7,
lowColor = "#FFBC80", highColor = "#FC4F4F",
size = 1,
title = "scPagwas_score",
do_plot = T)
library("RColorBrewer")
library("ggplot2")
scPagwas_score <- Pagwas$scPagwas_score[intersect(colnames(scRNAexample),names(Pagwas$scPagwas_score))]
scRNAexample$scPagwas_score <- scPagwas_score
thre <- sort(scRNAexample$scPagwas_score, decreasing = T)[ncol(scRNAexample) * 0.1]
scRNAexample$positiveCells<-rep(0,ncol(scRNAexample))
scRNAexample$positiveCells[scRNAexample$scPagwas_score>=thre]<-1
plot_bar_positie_nagtive(seurat_obj=scRNAexample,
var_ident="positiveCells",
var_group="anno",
vec_group_colors=NULL,
f_color=colorRampPalette(brewer.pal(n=10, name="RdYlBu")),
do_plot = T)
plot_bar_positie_nagtive(seurat_obj=scRNAexample,
var_ident="anno",
var_group="positiveCells",
vec_group_colors=c("#E8D0B3","#7EB5A6"),
do_plot = T)
top5genes<-rownames(Pagwas$gene_heritability_correlation)[order(Pagwas$gene_heritability_correlation,decreasing = T)[1:5]]
plot_vln_Corgenes(seurat_obj=scRNAexample,
assay="RNA", slot="data",
var_group="anno",
vec_features=top5genes,
vec_group_colors= pal_d3(alpha =0.5)(10),
do_plot = T
)
gc()
devtools::document()
usethis::use_version()
devtools::document()
gc()
pkgdown::build_site()
library(scPagwas)
suppressMessages(library(Seurat))
suppressWarnings(library(SOAR))
suppressMessages(library("dplyr"))
#Input pathway gene list, you can construct with youself.
data(Genes_by_pathway_kegg)
#gene annotation files.
data(block_annotation)
#LD data
data(chrom_ld)
#1.start to run the wrapper functions for preprogress.
Pagwas<-scPagwas_main(Pagwas = NULL,
gwas_data =system.file("extdata", "GWAS_summ_example.txt", package = "scPagwas"),
add_eqtls="OnlyTSS",
block_annotation = block_annotation,
assay="RNA",
Single_data = system.file("extdata", "scRNAexample.rds", package = "scPagwas"),
nfeatures =NULL,
Pathway_list=Genes_by_pathway_kegg,
chrom_ld = chrom_ld)
##------ Mon Mar 28 10:54:31 2022 ------##
##------ Mon Mar 28 10:54:32 2022 ------##
##------ Mon Mar 28 10:54:41 2022 ------##
##------ Mon Mar 28 10:54:41 2022 ------##
##------ Mon Mar 28 10:54:41 2022 ------##
##------ Mon Mar 28 10:54:42 2022 ------##
Pagwas<-Celltype_heritability_contributions(Pagwas,iters = 200)
names(Pagwas)
Pagwas$bootstrap_results
